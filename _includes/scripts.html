<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{"/assets/vendor/startbootstrap-clean-blog/js/scripts.js" | relative_url }}"></script>

<script src="{{"/assets/scripts.js" | relative_url }}"></script>

{% if page.url contains 'contact' %}
  <!-- Form Validation -->
  <script src="{{"/assets/vendor/startbootstrap-clean-blog/js/jqBootstrapValidation.js" | relative_url }}"></script>
  <!-- Send Form -->
  <script>
    $(function() {
      // Initialize form validation
      $("#name, #email, #message").jqBootstrapValidation({
        preventSubmit: true,
        submitError: function($form, event, errors) {
          // additional error messages or events
        },
        submitSuccess: function($form, event) {
          event.preventDefault(); // prevent default submit behavior
          
          // Get form data
          var name = $("input#name").val();
          var email = $("input#email").val();
          var message = $("textarea#message").val();
          
          // Submit form via fetch
          var formData = new FormData($form[0]);
          
          fetch($form.attr('action'), {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          }).then(response => {
            if (response.ok) {
              // Success message
              $('#success').html("<div class='alert alert-success'>");
              $('#success > .alert-success').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>");
              $('#success > .alert-success').append("<strong>Thank you for your message! I will get back to you as soon as possible -- Guillermo</strong>");
              $('#success > .alert-success').append('</div>');
              
              // Clear form
              $('#contactForm').trigger("reset");
            } else {
              // Error message
              $('#success').html("<div class='alert alert-danger'>");
              $('#success > .alert-danger').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>");
              $('#success > .alert-danger').append("<strong>Sorry " + name + ", it seems that there was an error sending your message. Please try again later!</strong>");
              $('#success > .alert-danger').append('</div>');
            }
          }).catch(error => {
            // Network error
            $('#success').html("<div class='alert alert-danger'>");
            $('#success > .alert-danger').html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>");
            $('#success > .alert-danger').append("<strong>Oops! There was a problem submitting your form. Please check your internet connection and try again.</strong>");
            $('#success > .alert-danger').append('</div>');
          });
        },
        filter: function() {
          return $(this).is(":visible");
        },
      });

      $("a[data-toggle=\"tab\"]").click(function(e) {
        e.preventDefault();
        $(this).tab("show");
      });
    });

    // Clear success/error message when user starts typing
    $('#name, #email, #message').focus(function() {
      $('#success').html('');
    });
  </script>
{% endif %}
